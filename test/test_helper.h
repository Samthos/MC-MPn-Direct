#ifndef OVPS_TEST_HELPER_H_
#define OVPS_TEST_HELPER_H_

#include <thrust/device_vector.h>
#include <vector>

  void vfill(thrust::device_vector<double>& v) {
    thrust::fill(v.begin(), v.end(), -1);
  }
  
  std::vector<double> get_vector(thrust::device_vector<double>& v) {
    std::vector<double> w(v.size());
    thrust::copy(v.begin(), v.end(), w.begin());
    return w;
  }
  
  void vfill(std::vector<double>& v) {
    std::fill(v.begin(), v.end(), -1);
  }
  
  std::vector<double> get_vector(std::vector<double> v) {
    return v;
  }

std::vector<double> make_psi(int n_electron_pairs, int n_orbitals, double sign) {
  // the values of psi are such that they produce green's functions traces that
  // are polygamma values multipled by a factor that depends on the row/col of 
  // the trace
  std::vector<double> v(n_electron_pairs * n_orbitals);
  for (int col = 0; col < n_electron_pairs; col++) {
    for (int row = 0; row < n_orbitals; row++) {
      v[col * n_orbitals + row] = sign * 1.0 / ((col+1) * (row+1));
    }
  }
  return v;
}
  
double PolyGamma(int n, int z) {
  // polygamma is hard to implement......
  // values generated by mathematic
  assert(n >= 0 && n <= 20 && z >= 1 && z <= 20);
  std::vector<std::vector<double>> values = 
    {
 {-0.5772156649015329, 1.644934066848226, -2.404113806319189,
  6.493939402266829, -24.88626612344088,
  122.0811674381339, -726.0114797149844,
  5060.549875237639, -40400.97839874763,
  363240.9114223826, -3.630593311606629E6,
  3.992662298773109E7, -4.790603798898315E8,
  6.227402193410972E9, -8.718095783017207E10,
  1.307694352218914E12, -2.092294967948151E13,
  3.556887858592237E14, -6.402385922818921E15,
  1.216452164536394E17, -2.432903168507861E18},
 {0.4227843350984671, 0.6449340668482264, -0.4041138063191886,
  0.4939394022668291, -0.8862661234408782,
  2.081167438133897, -6.011479714984435,
  20.54987523763947, -80.97839874763489,
  360.9114223826268, -1793.311606628713,
  9822.987731086702, -58779.88983145243,
  381393.4109717642, -2.666630172067845E6,
  1.998421891382089E7, -1.597914815109066E8,
  1.357763223715976E9, -1.221709092140074E10,
  1.160448073966699E11, -1.160331221321737E12},
 {0.9227843350984671, 0.3949340668482264, -0.1541138063191886,
  0.1189394022668291, -0.1362661234408782,
  0.2061674381338968, -0.3864797149844353,
  0.8623752376394705, -2.228398747634885,
  6.536422382626807, -21.43660662871299,
  77.67523108670233, -308.0148314524269,
  1326.223471764193, -6159.859567845191,
  30691.57007089010, -163262.7609066317,
  923364.3409756124, -5.532187025735649E6,
  3.499942010737670E7, -2.331415561122568E8},
 {1.256117668431800, 0.2838229557371153, -0.08003973224511450,
  0.04486532819275508, -0.03750069134211280,
  0.04155838463595438, -0.05726160798855055,
  0.09419965464907266, -0.1799305263271578,
  0.3910177187036247, -0.9519244156357158,
  2.564729638752319, -7.572825660626846,
  24.30811333305939, -84.25456183323505,
  313.5450408303190, -1246.627412979491,
  5272.917844916797, -23638.48695147586,
  111946.0284102635, -558395.5858139331},
 {1.506117668431800, 0.2213229557371153, -0.04878973224511450,
  0.02142782819275508, -0.01406319134211280,
  0.01226150963595438, -0.01331629548855055,
  0.01729535777407266, -0.02612193257715785,
  0.04494838276612470, -0.08675107579196581,
  0.1855029541820070, -0.4351456069159088,
  1.110653158498841, -3.063451222273134,
  9.078376039211870, -28.76075381506239,
  96.98454346797537, -346.7870949561583,
  1310.454091794929, -5217.714221590228},
 {1.706117668431800, 0.1813229557371153, -0.03278973224511450,
  0.01182782819275508, -0.006383191342112800,
  0.004581509635954379, -0.004100295488550551,
  0.004392957774072663, -0.005478092577157847,
  0.007789470766124702, -0.01243325179196581,
  0.02200374138200695, -0.04274749619590878,
  0.09041807062684111, -0.2067929762315343,
  0.5084013010870698, -1.336834653063031,
  3.743218317177547, -11.11832441328612,
  34.91276373201481, -115.5489093385708},
 {1.872784335098467, 0.1535451779593375, -0.02353047298585524,
  0.007198198563125445, -0.003296771589026380,
  0.002009493175049029, -0.001528279027645201,
  0.001392271903016422, -0.001477178082416192,
  0.001788099024012219, -0.002430965555111675,
  0.003666216614441033, -0.006072446660776942,
  0.01095546330072212, -0.02138022580392329,
  0.04486942501804237, -0.1007496502122909,
  0.2409774757671180, -0.6116018890548327,
  1.641475738615733, -4.644616027240543},
 {2.015641477955610, 0.1331370146940314, -0.01769956919576777,
  0.004699239795945104, -0.001868795150637614,
  0.0009895100047713387, -0.0006540077388357523,
  0.0005180006142069730, -0.0004780108952053932,
  0.0005034554975983348, -0.0005957605173775549,
  0.0007823229837159866, -0.001128629008105434,
  0.001774087660046464, -0.003017474522571974,
  0.005520672272289554, -0.01080964393628449,
  0.02255174623967377, -0.04993572741283330,
  0.1169532998731638, -0.2888376308332013},
 {2.140641477955610, 0.1175120146940314, -0.01379331919576777,
  0.003234396045945104, -0.001136373275637614,
  0.0005317463328963387, -0.0003106849849295023,
  0.0002175932045390043, -0.0001776034855374245,
  0.0001654971617218700, -0.0001733125975319738,
  0.0002014570939283126, -0.0002573301734239233,
  0.0003582270536890090, -0.0005397184614464277,
  0.0008748796576791543, -0.001518058707063686,
  0.002807127627579573, -0.005510335535621351,
  0.01144299416478539, -0.02506186656225533},
 {2.251752589066721, 0.1051663356816857, -0.01104983497080207,
  0.002319901304289868, -0.0007299311682352866,
  0.0003059451621172682, -0.0001601508710767886,
  0.0001005111159868936, -0.00007353051793554838,
  0.00006142419411999388, -0.00005767596686322259,
  0.00006012343422206113, -0.00006888529381558793,
  0.00008602889425474683, -0.0001162991023264644,
  0.0001691807258125487, -0.0002634828281897204,
  0.0004373731897065272, -0.0007708266598752588,
  0.001437364315988080, -0.002827133564927983},
 {2.351752589066721, 0.09516633568168575, -0.009049834970802067,
  0.001719901304289868, -0.0004899311682352866,
  0.0001859451621172682, -0.00008815087107678861,
  0.00005011111598689363, -0.00003321051793554838,
  0.00002513619411999388, -0.00002138796686322259,
  0.00002020663422206113, -0.00002098513381558793,
  0.00002375868625474683, -0.00002912081112646438,
  0.00003841328901254874, -0.00005425492930972039,
  0.00008168576161052724, -0.0001305892893024588,
  0.0002209133118997598, -0.0003942315567513425},
 {2.442661679975812, 0.08690187287176839, -0.007547205368998912,
  0.001310093231070826, -0.0003409100507010894,
  0.0001182082905108149, -0.00005120348656417772,
  0.00002659914402432307, -0.00001611090196276979,
  0.00001114559923317503, -8.669244238841822E-6,
  7.487911597680360E-6, -7.110163679899815E-6,
  7.360994276206331E-6, -8.251021335594653E-6,
  9.954484752271841E-6, -0.00001286030493113581,
  0.00001771225120726016, -0.00002590536318802172,
  0.00004009562133845949, -0.00006547211936716010},
 {2.525995013309145, 0.07995742842732395, -0.006389797961591505,
  0.001020741379218974, -0.0002444594334171388,
  0.00007802053330916883, -0.00003110960796335468,
  0.00001487771484050962, -8.296615840227496E-6,
  5.284884641268306E-6, -3.785315412252888E-6,
  3.010976839973837E-6, -2.633228922193292E-6,
  2.510981622024264E-6, -2.592673239048908E-6,
  2.881549631589660E-6, -3.429724770226232E-6,
  4.352262645971596E-6, -5.865380346088873E-6,
  8.365648505399153E-6, -0.00001258883131205953},
 {2.602918090232222, 0.07404026866401034, -0.005479465690312488,
  0.0008106647012315087, -0.0001798204555748417,
  0.00005315938798520842, -0.00001963523319844987,
  8.699205351714730E-6, -4.494456154815254E-6,
  2.652620243675215E-6, -1.760496644873587E-6,
  1.297668652191352E-6, -1.051713671932536E-6,
  9.294663717635081E-7, -8.895029695373249E-7,
  9.163531667686026E-7, -1.011021428908008E-6,
  1.189342891940072E-6, -1.485952994352917E-6,
  1.964946991323524E-6, -2.741598213481645E-6},
 {2.674346661660794, 0.06893822784768381, -0.004750602716551555,
  0.0006544797782827373, -0.0001351961918751928,
  0.00003722215094961951, -0.00001280498875462605,
  5.284083129802820E-6, -2.542957742294163E-6,
  1.398085549911656E-6, -8.644004350424738E-7,
  5.935930587526196E-7, -4.482203061279089E-7,
  3.690796749449255E-7, -3.291162727187424E-7,
  3.159388487486927E-7, -3.248336368852541E-7,
  3.561148587695848E-7, -4.146598088480044E-7,
  5.110490967097152E-7, -6.646012211762035E-7},
 {2.741013328327460, 0.06449378340323936, -0.004158010123958962,
  0.0005359612597642188, -0.0001035912536035878,
  0.00002668717152575120, -8.590996985078729E-6,
  3.317553637347401E-6, -1.494142012984606E-6,
  7.687961123259225E-7, -4.448741433186512E-7,
  2.859404448218164E-7, -2.020982149832663E-7,
  1.557738626195686E-7, -1.300308478817426E-7,
  1.168534239116930E-7, -1.124758503924543E-7,
  1.154427007444117E-7, -1.258532192177967E-7,
  1.452274165114521E-7, -1.768389809118527E-7},
 {2.803513328327460, 0.06058753340323936, -0.003669728873958962,
  0.0004444085253892188, -0.00008070307000983783,
  0.00001953461415270432, -5.908787970186151E-6,
  2.144087193331898E-6, -9.074087909768549E-7,
  4.387586749465623E-7, -2.386007449565511E-7,
  1.441274834478726E-7, -9.573849395280842E-8,
  6.935658928232156E-8, -5.441573371165143E-8,
  4.596425437723252E-8, -4.158668085799387E-8,
  4.012295811404748E-8, -4.111850875863697E-8,
  4.460494784119993E-8, -5.106089507403749E-8},
 {2.862336857739225, 0.05712732579078261, -0.003262645625434639,
  0.0003725703050613971, -0.00006379995934446801,
  0.00001456311101583084, -4.154139804230806E-6,
  1.421585007350286E-6, -5.674077622796255E-7,
  2.587581303421467E-7, -1.327180716598360E-7,
  7.561516543235105E-8, -4.737685770655795E-8,
  3.237416156460060E-8, -2.395961676764594E-8,
  1.909121001487473E-8, -1.629440381106889E-8,
  1.483068106712251E-8, -1.433845070895170E-8,
  1.467429472684581E-8, -1.584836199832675E-8},
 {2.917892413294781, 0.05404090603769619, -0.002919710097313926,
  0.0003154143837079449, -0.00005109864348814529,
  0.00001103496772240787, -2.978092039756481E-6,
  9.642330989436037E-7, -3.641402474322112E-7,
  1.571243729184396E-7, -7.625487309110981E-8,
  4.110987741812949E-8, -2.437333236374357E-8,
  1.576050437256800E-8, -1.103788339606503E-8,
  8.323098871890638E-9, -6.722749461749698E-9,
  5.790785292765489E-9, -5.298554934594684E-9,
  5.132182520580067E-9, -5.246015102475931E-9},
 {2.970523992242149, 0.05127082293520312, -0.002628122402314655,
  0.0002693742213396389, -0.00004140597772639667,
  8.484266206158230E-6, -2.172607350414490E-6,
  6.674755818176071E-7, -2.391897139054758E-7,
  9.793727808998598E-8, -4.510377054981843E-8,
  2.307502857843448E-8, -1.298290151762041E-8,
  7.967051688378469E-9, -5.295339312978005E-9,
  3.789511437874567E-9, -2.904991622578269E-9,
  2.374896699822632E-9, -2.062449951806715E-9,
  1.896077537792097E-9, -1.839588804804384E-9}
} ;
  return values[z-1][n];
}

double PolyGamma_Difference(int start, int stop, int n) {
  double fac = 1;
  for (int i = 1; i <= n; i++) {
    fac *= -i;
  }
  double polygamma =  PolyGamma(n, stop + 1) - PolyGamma(n, start + 1);
  return polygamma / fac;
}

#endif  // OVPS_TEST_HELPER_H_
